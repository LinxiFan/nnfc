language: cpp
sudo: required

addons:
  apt:
    sources:
    - ubuntu-toolchain-r-test
    packages:
    - gcc-5
    - g++-5
    - nasm
    - python3.5-dev
    - python3-pip

before_install:
    - sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.4 99
    - python3 --version
    - sudo pip3 install http://download.pytorch.org/whl/cpu/torch-0.3.1-cp34-cp34m-linux_x86_64.whl
    - sudo pip3 install cffi torchvision

install:
  # upgrade gcc
  - sudo apt-get update -q
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 99
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 99
  # verify installed versions
  - g++ -v

script:
  - ./autogen.sh
  - ./configure
  - make -j3
  - ./python/install.sh
  - make check

notifications:
  email: false
